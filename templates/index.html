<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora CientÃ­fica SimbÃ³lica</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <div class="container">
    <h1>Calculadora CientÃ­fica SimbÃ³lica</h1>
    <form method="POST">
      <textarea id="expresion" name="expresion" placeholder="Ingresa la expresiÃ³n aquÃ­" required>{{ expresion }}</textarea>
      
      <div class="calculator">
        {% for btn in ['7','8','9','/','sin(x)','cos(x)','tan(x)',
                       '4','5','6','*','ln(x)','log(x)','sqrt(x)',
                       '1','2','3','-','^','(',')',
                       '0','.','+','x','e','pi'] %}
          <button type="button" onclick="insert('{{ btn }}')">{{ btn }}</button>
        {% endfor %}
        <button type="button" onclick="borrar()">âŒ«</button>
        <button type="button" onclick="limpiar()">C</button>
      </div>

      <select name="operacion" id="operacion" required onchange="mostrarCampoLimite(this.value)">
        <option value="derivar">Derivar</option>
        <option value="integrar">Integrar</option>
        <option value="limite">LÃ­mite</option>
      </select>

      <input type="text" name="punto_limite" id="campo-limite" placeholder="x â†’ ?" style="display: none; margin-top: 10px; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">

      <button type="submit">Calcular</button>
    </form>

    {% if error %}
      <div class="resultado" style="border-left: 4px solid red;">
        <h2 style="color: red;">Error:</h2>
        <p>{{ error }}</p>
      </div>
    {% endif %}

    {% if resultado %}
      <div class="resultado">
        <h2>Resultado:</h2>
        <p>\\[{{ resultado }}\\]</p>

        <h3>Pasos:</h3>
        {% for paso in pasos %}
          <p>\\[{{ paso }}\\]</p>
        {% endfor %}

        <a href="/descargar" class="boton-pdf">ðŸ“„ Descargar PDF</a>

        <div id="grafico"></div>
        <script>
          var datos = {{ grafico | safe }};
          Plotly.newPlot('grafico', datos.data, datos.layout);
        </script>
      </div>
    {% endif %}
  </div>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
